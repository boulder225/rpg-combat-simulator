---
phase: 02-creature-data-monte-carlo
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/io/srd_api.py
  - src/domain/srd_models.py
autonomous: true
user_setup: []

must_haves:
  truths:
    - "System can fetch creature data from dnd5eapi.co API"
    - "API responses are validated and transformed to standard creature format"
    - "Failed API calls are handled gracefully with clear error messages"
  artifacts:
    - path: "src/io/srd_api.py"
      provides: "SRD API client with error handling and retry logic"
      exports: ["SRDCreatureAPI"]
    - path: "src/domain/srd_models.py"
      provides: "Pydantic models for SRD API responses"
      contains: "SRDCreature, SRDAction, SRDAttack"
  key_links:
    - from: "src/io/srd_api.py"
      to: "src/domain/srd_models.py"
      via: "Pydantic model validation"
      pattern: "SRDCreature\\.model_validate"
    - from: "src/io/srd_api.py"
      to: "dnd5eapi.co"
      via: "HTTP requests"
      pattern: "requests\\.get.*dnd5eapi\\.co"
---

<objective>
Integrate dnd5eapi.co API for fetching SRD creature data and transform it to standard creature format.

Purpose: Enable DMs to use SRD creature names directly without manual data entry, supporting the core workflow of specifying creatures like "goblin" instead of full stat blocks.
Output: SRD API client and data transformation utilities that can fetch and validate creature data from the official D&D 5e SRD API.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-creature-data-monte-carlo/02-CONTEXT.md
@.planning/phases/02-creature-data-monte-carlo/02-RESEARCH.md

@src/domain/creature.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SRD API client with error handling</name>
  <files>src/io/srd_api.py</files>
  <action>
Create SRD API client class SRDCreatureAPI that:
- Uses requests library to fetch from https://www.dnd5eapi.co/api/2014/monsters/{name}
- Converts creature names to API format (lowercase, spaces to hyphens)
- Implements timeout (10s) and basic error handling for 404/500 responses
- Includes retry logic with exponential backoff for network errors
- Returns raw JSON response for transformation layer
- Uses proper User-Agent header to identify as dnd-simulator
  </action>
  <verify>python -c "from src.io.srd_api import SRDCreatureAPI; api = SRDCreatureAPI(); print('API client created successfully')"</verify>
  <done>API client can be instantiated and handles basic error cases without crashing</done>
</task>

<task type="auto">
  <name>Task 2: Create SRD data models and transformation</name>
  <files>src/domain/srd_models.py</files>
  <action>
Create Pydantic models for SRD API responses and transformation logic:
- Define SRDCreature, SRDAction, SRDAttack models matching dnd5eapi.co JSON structure
- Implement transform_api_data method that converts SRD API response to standard Creature format
- Handle common attack patterns: extract attack bonus, damage dice, damage type, reach/range from action descriptions
- Support only melee/ranged attacks (skip spellcasting, legendary actions as per Phase 2 scope)
- Include proper validation and error handling for missing or malformed data
- Use computed fields for derived values where appropriate
  </action>
  <verify>python -c "from src.domain.srd_models import SRDCreature; print('SRD models imported successfully')"</verify>
  <done>SRD models can parse API responses and transform them to standard creature format with validated attack data</done>
</task>

</tasks>

<verification>
- SRD API client can fetch real creature data (e.g., "goblin") without errors
- Transformed creature data matches the expected format used by the combat engine
- Error handling works for invalid creature names (404) and network issues
</verification>

<success_criteria>
- DM can call SRDCreatureAPI().fetch_monster("goblin") and get valid creature data
- Transformed creature data includes all required fields (name, ac, hp_max, actions, etc.)
- Invalid creature names return appropriate errors without crashing the system
</success_criteria>

<output>
After completion, create `.planning/phases/02-creature-data-monte-carlo/02-01-SUMMARY.md`
</output>